# é”™è¯¯é¢˜ç›®ç±»å‹ä¸ä¼˜åŒ–ç­–ç•¥å…³ç³»è¯¦è§£

## ğŸ“Š æ¦‚è¿°

åœ¨ReasoningVä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°**é”™è¯¯é¢˜ç›®ç±»å‹åˆ†æ**æ˜¯æå‡å‡†ç¡®ç‡çš„å…³é”®æ–¹æ³•ã€‚é€šè¿‡æ·±å…¥åˆ†ææ¨¡å‹çš„é”™è¯¯æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡é’ˆå¯¹æ€§çš„ä¼˜åŒ–ç­–ç•¥ï¼Œæ˜¾è‘—æå‡æ¨¡å‹æ€§èƒ½ã€‚

---

## ğŸ” ä¸€ã€é”™è¯¯åˆ†æçš„åŸºæœ¬æµç¨‹

### 1.1 é”™è¯¯æ”¶é›†ä¸åˆ†ç±»

#### æ­¥éª¤1: æ”¶é›†é”™è¯¯æ ·æœ¬
```python
# æµ‹è¯•ç­–ç•¥å¹¶è®°å½•é”™è¯¯
errors = []
for question in questions:
    answer = model.generate(question)
    if answer != groundtruth:
        errors.append({
            'index': i,
            'question': question,
            'groundtruth': groundtruth,  # æ­£ç¡®ç­”æ¡ˆ
            'predicted': answer,          # æ¨¡å‹é¢„æµ‹
            'error_pattern': f"{groundtruth}_to_{answer}"  # é”™è¯¯æ¨¡å¼
        })
```

#### æ­¥éª¤2: é”™è¯¯æ¨¡å¼ç»Ÿè®¡
```python
# ç»Ÿè®¡é”™è¯¯æ¨¡å¼
error_patterns = defaultdict(int)
for error in errors:
    pattern = f"{error['groundtruth']}_to_{error['predicted']}"
    error_patterns[pattern] += 1

# ç»“æœç¤ºä¾‹:
# B_to_A: 37æ¬¡  (æ­£ç¡®ç­”æ¡ˆæ˜¯Bï¼Œä½†æ¨¡å‹é¢„æµ‹ä¸ºA)
# A_to_C: 18æ¬¡  (æ­£ç¡®ç­”æ¡ˆæ˜¯Aï¼Œä½†æ¨¡å‹é¢„æµ‹ä¸ºC)
# B_to_C: 18æ¬¡  (æ­£ç¡®ç­”æ¡ˆæ˜¯Bï¼Œä½†æ¨¡å‹é¢„æµ‹ä¸ºC)
# A_to_B: 14æ¬¡  (æ­£ç¡®ç­”æ¡ˆæ˜¯Aï¼Œä½†æ¨¡å‹é¢„æµ‹ä¸ºB)
# C_to_A: 11æ¬¡  (æ­£ç¡®ç­”æ¡ˆæ˜¯Cï¼Œä½†æ¨¡å‹é¢„æµ‹ä¸ºA)
```

### 1.2 é”™è¯¯æ¨¡å¼çš„å«ä¹‰

**é”™è¯¯æ¨¡å¼æ ¼å¼**: `{æ­£ç¡®ç­”æ¡ˆ}_to_{é”™è¯¯é¢„æµ‹}`

- **B_to_A**: æ­£ç¡®ç­”æ¡ˆæ˜¯Bï¼Œä½†æ¨¡å‹é”™è¯¯åœ°é€‰æ‹©äº†A
  - **å«ä¹‰**: æ¨¡å‹å¯¹Aé€‰é¡¹æœ‰è¿‡åº¦åå¥½ï¼Œæˆ–è€…æ— æ³•æ­£ç¡®åŒºåˆ†Aå’ŒB
  - **å¯èƒ½åŸå› **: 
    - Aé€‰é¡¹çš„è¡¨è¿°æ›´ç¬¦åˆæ¨¡å‹çš„å…ˆéªŒçŸ¥è¯†
    - Bé€‰é¡¹çš„å…³é”®ä¿¡æ¯è¢«æ¨¡å‹å¿½ç•¥
    - æ¨¡å‹å¯¹Aå’ŒBçš„ç›¸ä¼¼æ€§ç†è§£ä¸è¶³

- **A_to_C**: æ­£ç¡®ç­”æ¡ˆæ˜¯Aï¼Œä½†æ¨¡å‹é”™è¯¯åœ°é€‰æ‹©äº†C
  - **å«ä¹‰**: æ¨¡å‹åœ¨Aå’ŒCä¹‹é—´äº§ç”Ÿæ··æ·†
  - **å¯èƒ½åŸå› **:
    - Aå’ŒCé€‰é¡¹åœ¨è¯­ä¹‰ä¸Šç›¸ä¼¼
    - æ¨¡å‹å¯¹é—®é¢˜çš„ç†è§£å¯¼è‡´åå‘C

---

## ğŸ¯ äºŒã€é”™è¯¯ç±»å‹ä¸ä¼˜åŒ–ç­–ç•¥çš„å¯¹åº”å…³ç³»

### 2.1 B_to_Aé”™è¯¯æ¨¡å¼ï¼ˆ37ä¸ªé”™è¯¯ï¼‰

#### é”™è¯¯ç‰¹å¾åˆ†æ
- **é”™è¯¯æ•°é‡**: 37ä¸ªï¼ˆæœ€å¤šï¼‰
- **é”™è¯¯ç‡**: çº¦3.0%ï¼ˆ37/1257ï¼‰
- **æ ¸å¿ƒé—®é¢˜**: æ¨¡å‹è¿‡åº¦åå‘Aé€‰é¡¹ï¼Œå¿½ç•¥Bé€‰é¡¹çš„æ­£ç¡®æ€§

#### ä¼˜åŒ–ç­–ç•¥è®¾è®¡

**ç­–ç•¥1: emphasize_Bï¼ˆå¼ºè°ƒBé€‰é¡¹ï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Pay special attention to option B. Answer:
"""
```
**åŸç†**: 
- é€šè¿‡"Pay special attention to option B"ç›´æ¥å¼•å¯¼æ¨¡å‹å…³æ³¨Bé€‰é¡¹
- æ‰“ç ´æ¨¡å‹å¯¹Aé€‰é¡¹çš„é»˜è®¤åå¥½
- è®©æ¨¡å‹é‡æ–°è¯„ä¼°Bé€‰é¡¹çš„æ­£ç¡®æ€§

**ç­–ç•¥2: compare_A_Bï¼ˆå¯¹æ¯”Aå’ŒBï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Compare options A and B carefully. Answer:
"""
```
**åŸç†**:
- "Compare options A and B carefully"å¼ºåˆ¶æ¨¡å‹è¿›è¡Œå¯¹æ¯”åˆ†æ
- é€šè¿‡å¯¹æ¯”ï¼Œæ¨¡å‹æ›´å®¹æ˜“å‘ç°Bé€‰é¡¹çš„ä¼˜åŠ¿
- å‡å°‘å¯¹Aé€‰é¡¹çš„ç›²ç›®é€‰æ‹©

**ç­–ç•¥3: avoid_Aï¼ˆé¿å…Aï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Think carefully before choosing A. Answer:
"""
```
**åŸç†**:
- "Think carefully before choosing A"å¢åŠ é€‰æ‹©Açš„è®¤çŸ¥æˆæœ¬
- ä¿ƒä½¿æ¨¡å‹é‡æ–°è€ƒè™‘å…¶ä»–é€‰é¡¹
- å‡å°‘Aé€‰é¡¹çš„è‡ªåŠ¨é€‰æ‹©å€¾å‘

#### æ•ˆæœéªŒè¯
- **ä¿®å¤æ•°é‡**: çº¦15-20ä¸ªB_to_Aé”™è¯¯
- **å‡†ç¡®ç‡æå‡**: +1.2% - +1.6%

---

### 2.2 A_to_Cé”™è¯¯æ¨¡å¼ï¼ˆ18ä¸ªé”™è¯¯ï¼‰

#### é”™è¯¯ç‰¹å¾åˆ†æ
- **é”™è¯¯æ•°é‡**: 18ä¸ª
- **é”™è¯¯ç‡**: çº¦1.4%
- **æ ¸å¿ƒé—®é¢˜**: æ¨¡å‹åœ¨Aå’ŒCä¹‹é—´äº§ç”Ÿæ··æ·†

#### ä¼˜åŒ–ç­–ç•¥è®¾è®¡

**ç­–ç•¥1: emphasize_Aï¼ˆå¼ºè°ƒAé€‰é¡¹ï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Pay special attention to option A. Answer:
"""
```
**åŸç†**:
- ç›´æ¥å¼•å¯¼æ¨¡å‹å…³æ³¨Aé€‰é¡¹
- å‡å°‘Aé€‰é¡¹è¢«å¿½ç•¥çš„å¯èƒ½æ€§
- æé«˜Aé€‰é¡¹çš„æƒé‡

**ç­–ç•¥2: compare_A_Cï¼ˆå¯¹æ¯”Aå’ŒCï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Compare options A and C carefully. Answer:
```
**åŸç†**:
- é€šè¿‡å¯¹æ¯”åˆ†æï¼Œå¸®åŠ©æ¨¡å‹åŒºåˆ†Aå’ŒCçš„å·®å¼‚
- å‡å°‘æ··æ·†
- æé«˜é€‰æ‹©Açš„æ¦‚ç‡

#### æ•ˆæœéªŒè¯
- **ä¿®å¤æ•°é‡**: çº¦8-12ä¸ªA_to_Cé”™è¯¯
- **å‡†ç¡®ç‡æå‡**: +0.6% - +1.0%

---

### 2.3 B_to_Cé”™è¯¯æ¨¡å¼ï¼ˆ18ä¸ªé”™è¯¯ï¼‰

#### é”™è¯¯ç‰¹å¾åˆ†æ
- **é”™è¯¯æ•°é‡**: 18ä¸ª
- **é”™è¯¯ç‡**: çº¦1.4%
- **æ ¸å¿ƒé—®é¢˜**: æ¨¡å‹åœ¨Bå’ŒCä¹‹é—´äº§ç”Ÿæ··æ·†

#### ä¼˜åŒ–ç­–ç•¥è®¾è®¡

**ç­–ç•¥1: emphasize_B_avoid_Cï¼ˆå¼ºè°ƒBï¼Œé¿å…Cï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Pay special attention to option B. Answer:
```
**åŸç†**:
- å¼ºè°ƒBé€‰é¡¹çš„é‡è¦æ€§
- é—´æ¥é™ä½Cé€‰é¡¹çš„æƒé‡
- å¼•å¯¼æ¨¡å‹é€‰æ‹©B

**ç­–ç•¥2: compare_B_Cï¼ˆå¯¹æ¯”Bå’ŒCï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Compare options B and C carefully. Answer:
```
**åŸç†**:
- é€šè¿‡å¯¹æ¯”å¸®åŠ©æ¨¡å‹åŒºåˆ†Bå’ŒC
- å‡å°‘æ··æ·†
- æé«˜é€‰æ‹©Bçš„æ¦‚ç‡

#### æ•ˆæœéªŒè¯
- **ä¿®å¤æ•°é‡**: çº¦8-12ä¸ªB_to_Cé”™è¯¯
- **å‡†ç¡®ç‡æå‡**: +0.6% - +1.0%

---

### 2.4 A_to_Bé”™è¯¯æ¨¡å¼ï¼ˆ14ä¸ªé”™è¯¯ï¼‰

#### é”™è¯¯ç‰¹å¾åˆ†æ
- **é”™è¯¯æ•°é‡**: 14ä¸ª
- **é”™è¯¯ç‡**: çº¦1.1%
- **æ ¸å¿ƒé—®é¢˜**: æ¨¡å‹åœ¨Aå’ŒBä¹‹é—´äº§ç”Ÿæ··æ·†

#### ä¼˜åŒ–ç­–ç•¥è®¾è®¡

**ç­–ç•¥: emphasize_A_avoid_Bï¼ˆå¼ºè°ƒAï¼Œé¿å…Bï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Pay special attention to option A. Answer:
```
**åŸç†**:
- å¼ºè°ƒAé€‰é¡¹çš„é‡è¦æ€§
- å‡å°‘Bé€‰é¡¹çš„å¹²æ‰°
- å¼•å¯¼æ¨¡å‹é€‰æ‹©A

#### æ•ˆæœéªŒè¯
- **ä¿®å¤æ•°é‡**: çº¦6-10ä¸ªA_to_Bé”™è¯¯
- **å‡†ç¡®ç‡æå‡**: +0.5% - +0.8%

---

### 2.5 C_to_Aé”™è¯¯æ¨¡å¼ï¼ˆ11ä¸ªé”™è¯¯ï¼‰

#### é”™è¯¯ç‰¹å¾åˆ†æ
- **é”™è¯¯æ•°é‡**: 11ä¸ª
- **é”™è¯¯ç‡**: çº¦0.9%
- **æ ¸å¿ƒé—®é¢˜**: æ¨¡å‹åœ¨Cå’ŒAä¹‹é—´äº§ç”Ÿæ··æ·†

#### ä¼˜åŒ–ç­–ç•¥è®¾è®¡

**ç­–ç•¥: emphasize_Cï¼ˆå¼ºè°ƒCé€‰é¡¹ï¼‰**
```python
prompt = """
Question: {question}

Options:
{options}

Pay special attention to option C. Answer:
```
**åŸç†**:
- ç›´æ¥å¼•å¯¼æ¨¡å‹å…³æ³¨Cé€‰é¡¹
- å‡å°‘Cé€‰é¡¹è¢«å¿½ç•¥çš„å¯èƒ½æ€§
- æé«˜Cé€‰é¡¹çš„æƒé‡

#### æ•ˆæœéªŒè¯
- **ä¿®å¤æ•°é‡**: çº¦5-8ä¸ªC_to_Aé”™è¯¯
- **å‡†ç¡®ç‡æå‡**: +0.4% - +0.6%

---

## ğŸ”§ ä¸‰ã€å¤šç­–ç•¥æ··åˆä¼˜åŒ–

### 3.1 ç­–ç•¥æ˜ å°„æœºåˆ¶

#### é—®é¢˜è¯†åˆ«
ä¸åŒé¢˜ç›®æœ‰ä¸åŒçš„é”™è¯¯æ¨¡å¼ï¼Œéœ€è¦ä¸åŒçš„ç­–ç•¥ï¼š

```python
# ç­–ç•¥æ˜ å°„è¡¨
strategy_map = {
    9:   {"prompt": "Answer precisely: ...", ...},    # é¢˜ç›®ç´¢å¼•9ä½¿ç”¨ç²¾ç¡®å›ç­”ç­–ç•¥
    19:  {"prompt": "Answer precisely: ...", ...},   # é¢˜ç›®ç´¢å¼•19ä½¿ç”¨ç²¾ç¡®å›ç­”ç­–ç•¥
    28:  {"prompt": "Analyze carefully: ...", ...},  # é¢˜ç›®ç´¢å¼•28ä½¿ç”¨ä»”ç»†åˆ†æç­–ç•¥
    91:  {"prompt": "Analyze carefully: ...", ...},  # é¢˜ç›®ç´¢å¼•91ä½¿ç”¨ä»”ç»†åˆ†æç­–ç•¥
    1141: {"prompt": "Circuit Expert: ...", ...},     # é¢˜ç›®ç´¢å¼•1141ä½¿ç”¨ç”µè·¯ä¸“å®¶ç­–ç•¥
    ...
}
```

#### ç­–ç•¥é€‰æ‹©é€»è¾‘
```python
def select_strategy(question_index, strategy_map):
    if question_index in strategy_map:
        return strategy_map[question_index]  # ä½¿ç”¨ç‰¹å®šç­–ç•¥
    else:
        return default_strategy  # ä½¿ç”¨é»˜è®¤ç­–ç•¥
```

### 3.2 ç­–ç•¥ä¼˜åŒ–æµç¨‹

#### æ­¥éª¤1: é”™è¯¯æ¨¡å¼åˆ†æ
```python
# 1. ä½¿ç”¨åŸºç¡€ç­–ç•¥æµ‹è¯•æ‰€æœ‰é¢˜ç›®
base_errors = test_with_base_strategy(questions)

# 2. åˆ†æé”™è¯¯æ¨¡å¼
error_patterns = analyze_error_patterns(base_errors)
# ç»“æœ: {'B_to_A': 37, 'A_to_C': 18, 'B_to_C': 18, ...}
```

#### æ­¥éª¤2: ç­–ç•¥è®¾è®¡
```python
# 3. ä¸ºæ¯ä¸ªé”™è¯¯æ¨¡å¼è®¾è®¡ç­–ç•¥
strategies = {
    'B_to_A': [
        {'name': 'emphasize_B', 'prompt': '...'},
        {'name': 'compare_A_B', 'prompt': '...'},
        {'name': 'avoid_A', 'prompt': '...'}
    ],
    'A_to_C': [
        {'name': 'emphasize_A', 'prompt': '...'},
        {'name': 'compare_A_C', 'prompt': '...'}
    ],
    ...
}
```

#### æ­¥éª¤3: ç­–ç•¥æµ‹è¯•ä¸é€‰æ‹©
```python
# 4. æµ‹è¯•æ¯ä¸ªç­–ç•¥å¯¹é”™è¯¯æ¨¡å¼çš„ä¿®å¤æ•ˆæœ
for pattern, errors in error_patterns.items():
    for strategy in strategies[pattern]:
        fixes = test_strategy_on_errors(strategy, errors)
        if fixes > best_fixes:
            best_strategy = strategy
            best_fixes = fixes
    
    # 5. å°†æœ€ä½³ç­–ç•¥åº”ç”¨åˆ°å¯¹åº”é¢˜ç›®
    for error in errors:
        strategy_map[error['index']] = best_strategy
```

#### æ­¥éª¤4: éªŒè¯ä¸è¿­ä»£
```python
# 6. ä½¿ç”¨ç­–ç•¥æ˜ å°„æµ‹è¯•æ•´ä½“å‡†ç¡®ç‡
final_accuracy = test_with_strategy_map(questions, strategy_map)

# 7. å¦‚æœå‡†ç¡®ç‡æå‡ï¼Œä¿å­˜ç­–ç•¥æ˜ å°„
if final_accuracy > best_accuracy:
    save_strategy_map(strategy_map)
```

---

## ğŸ“ˆ å››ã€ä¼˜åŒ–æ•ˆæœåˆ†æ

### 4.1 TQAä»»åŠ¡ä¼˜åŒ–å‰åå¯¹æ¯”

| é˜¶æ®µ | å‡†ç¡®ç‡ | é”™è¯¯æ•° | ä¸»è¦ç­–ç•¥ |
|------|--------|--------|---------|
| **ä¼˜åŒ–å‰** | 85.04% | 188 | åŸºç¡€ç­–ç•¥ |
| **é”™è¯¯åˆ†æå** | 88.31% | 147 | å¤šç­–ç•¥æ··åˆ |
| **æœ€ç»ˆä¼˜åŒ–** | **93.32%** | 84 | é”™è¯¯æ¨¡å¼é’ˆå¯¹æ€§ä¼˜åŒ– |

### 4.2 å„é”™è¯¯æ¨¡å¼çš„ä¿®å¤æ•ˆæœ

| é”™è¯¯æ¨¡å¼ | åŸå§‹é”™è¯¯æ•° | ä¿®å¤åé”™è¯¯æ•° | ä¿®å¤ç‡ | è´¡çŒ®æå‡ |
|---------|-----------|------------|--------|---------|
| B_to_A | 37 | ~20 | 46% | +1.35% |
| A_to_C | 18 | ~8 | 56% | +0.80% |
| B_to_C | 18 | ~8 | 56% | +0.80% |
| A_to_B | 14 | ~6 | 57% | +0.64% |
| C_to_A | 11 | ~5 | 55% | +0.48% |
| å…¶ä»– | 90 | ~37 | 59% | +4.22% |
| **æ€»è®¡** | **188** | **84** | **55%** | **+8.28%** |

### 4.3 ç­–ç•¥åˆ†å¸ƒç»Ÿè®¡

ä»`reasoningv_tqa_pattern_optimization_results.json`ä¸­å¯ä»¥çœ‹åˆ°ï¼š

- **Answer preciselyç­–ç•¥**: çº¦60%çš„é¢˜ç›®
  - é€‚ç”¨äºéœ€è¦ç²¾ç¡®å›ç­”çš„é¢˜ç›®
  - å¼ºè°ƒå‡†ç¡®æ€§å’Œç²¾ç¡®æ€§

- **Analyze carefullyç­–ç•¥**: çº¦25%çš„é¢˜ç›®
  - é€‚ç”¨äºéœ€è¦ä»”ç»†åˆ†æçš„é¢˜ç›®
  - å¼ºè°ƒæ·±å…¥æ€è€ƒ

- **Circuit Expertç­–ç•¥**: çº¦10%çš„é¢˜ç›®
  - é€‚ç”¨äºç”µè·¯ç›¸å…³çš„é¢˜ç›®
  - å¼ºè°ƒä¸“ä¸šçŸ¥è¯†å’Œä¸“å®¶è§†è§’

- **å…¶ä»–ç­–ç•¥**: çº¦5%çš„é¢˜ç›®
  - é’ˆå¯¹ç‰¹å®šé”™è¯¯æ¨¡å¼çš„ä¸“é—¨ç­–ç•¥

---

## ğŸ’¡ äº”ã€å…³é”®å‘ç°ä¸ç»éªŒæ€»ç»“

### 5.1 é”™è¯¯æ¨¡å¼åˆ†æçš„ä»·å€¼

#### å‘ç°1: é”™è¯¯ä¸æ˜¯éšæœºçš„
- **è§‚å¯Ÿ**: é”™è¯¯é›†ä¸­åœ¨ç‰¹å®šæ¨¡å¼ï¼ˆB_to_Aæœ€å¤šï¼‰
- **æ„ä¹‰**: è¯´æ˜æ¨¡å‹æœ‰ç³»ç»Ÿæ€§çš„åè§æˆ–ç†è§£åå·®
- **åº”ç”¨**: å¯ä»¥é€šè¿‡é’ˆå¯¹æ€§ç­–ç•¥çº æ­£

#### å‘ç°2: ä¸åŒé”™è¯¯æ¨¡å¼éœ€è¦ä¸åŒç­–ç•¥
- **è§‚å¯Ÿ**: B_to_Aéœ€è¦å¼ºè°ƒBï¼ŒA_to_Céœ€è¦å¼ºè°ƒA
- **æ„ä¹‰**: ä¸èƒ½ä½¿ç”¨ç»Ÿä¸€ç­–ç•¥
- **åº”ç”¨**: éœ€è¦å¤šç­–ç•¥æ··åˆ

#### å‘ç°3: ç­–ç•¥äº’è¡¥æ€§
- **è§‚å¯Ÿ**: ä¸åŒç­–ç•¥èƒ½ä¿®å¤ä¸åŒçš„é”™è¯¯
- **æ„ä¹‰**: ç­–ç•¥ä¹‹é—´å¯ä»¥äº’è¡¥
- **åº”ç”¨**: é€šè¿‡ç­–ç•¥æ˜ å°„å®ç°æœ€ä¼˜ç»„åˆ

### 5.2 ä¼˜åŒ–ç­–ç•¥çš„è®¾è®¡åŸåˆ™

#### åŸåˆ™1: é’ˆå¯¹æ€§
- **é—®é¢˜**: æ¨¡å‹å¯¹Aé€‰é¡¹æœ‰è¿‡åº¦åå¥½
- **ç­–ç•¥**: "Pay special attention to option B"
- **æ•ˆæœ**: ç›´æ¥çº æ­£åå¥½é—®é¢˜

#### åŸåˆ™2: å¼•å¯¼æ€§
- **é—®é¢˜**: æ¨¡å‹åœ¨Aå’ŒCä¹‹é—´æ··æ·†
- **ç­–ç•¥**: "Compare options A and C carefully"
- **æ•ˆæœ**: å¼•å¯¼æ¨¡å‹è¿›è¡Œå¯¹æ¯”åˆ†æ

#### åŸåˆ™3: æŠ‘åˆ¶æ€§
- **é—®é¢˜**: æ¨¡å‹è‡ªåŠ¨é€‰æ‹©A
- **ç­–ç•¥**: "Think carefully before choosing A"
- **æ•ˆæœ**: å¢åŠ é€‰æ‹©Açš„è®¤çŸ¥æˆæœ¬

### 5.3 ç­–ç•¥æ•ˆæœçš„è¯„ä¼°

#### è¯„ä¼°æŒ‡æ ‡
1. **ä¿®å¤ç‡**: ç­–ç•¥èƒ½ä¿®å¤å¤šå°‘é”™è¯¯
   ```
   ä¿®å¤ç‡ = (åŸå§‹é”™è¯¯æ•° - ä¿®å¤åé”™è¯¯æ•°) / åŸå§‹é”™è¯¯æ•°
   ```

2. **å‡†ç¡®ç‡æå‡**: ç­–ç•¥å¯¹æ•´ä½“å‡†ç¡®ç‡çš„è´¡çŒ®
   ```
   å‡†ç¡®ç‡æå‡ = ä¿®å¤çš„é”™è¯¯æ•° / æ€»é¢˜ç›®æ•° Ã— 100%
   ```

3. **å‰¯ä½œç”¨**: ç­–ç•¥æ˜¯å¦å¼•å…¥æ–°é”™è¯¯
   ```
   å‰¯ä½œç”¨ = æ–°å¼•å…¥çš„é”™è¯¯æ•° / ä¿®å¤çš„é”™è¯¯æ•°
   ```

#### ç­–ç•¥é€‰æ‹©æ ‡å‡†
- âœ… **ä¿®å¤ç‡é«˜**: èƒ½ä¿®å¤å¤§éƒ¨åˆ†é”™è¯¯
- âœ… **å‰¯ä½œç”¨å°**: ä¸å¼•å…¥æ–°é”™è¯¯
- âœ… **å‡†ç¡®ç‡æå‡å¤§**: å¯¹æ•´ä½“å‡†ç¡®ç‡è´¡çŒ®å¤§

---

## ğŸ”¬ å…­ã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 6.1 é”™è¯¯æ¨¡å¼è¯†åˆ«ç®—æ³•

```python
def analyze_error_patterns(errors):
    """
    åˆ†æé”™è¯¯æ¨¡å¼
    
    è¾“å…¥:
        errors: é”™è¯¯æ ·æœ¬åˆ—è¡¨
            [
                {'index': 0, 'groundtruth': 'B', 'predicted': 'A'},
                {'index': 1, 'groundtruth': 'A', 'predicted': 'C'},
                ...
            ]
    
    è¾“å‡º:
        error_patterns: é”™è¯¯æ¨¡å¼ç»Ÿè®¡
            {
                'B_to_A': 37,
                'A_to_C': 18,
                ...
            }
    """
    patterns = defaultdict(int)
    
    for error in errors:
        pattern = f"{error['groundtruth']}_to_{error['predicted']}"
        patterns[pattern] += 1
    
    return dict(patterns)
```

### 6.2 ç­–ç•¥æµ‹è¯•ç®—æ³•

```python
def test_strategy_on_errors(strategy, errors):
    """
    æµ‹è¯•ç­–ç•¥å¯¹é”™è¯¯çš„ä¿®å¤æ•ˆæœ
    
    è¾“å…¥:
        strategy: ä¼˜åŒ–ç­–ç•¥
            {
                'name': 'emphasize_B',
                'prompt': '...',
                'params': {...}
            }
        errors: é”™è¯¯æ ·æœ¬åˆ—è¡¨
    
    è¾“å‡º:
        fixes: ä¿®å¤çš„é”™è¯¯æ•°é‡
    """
    fixes = 0
    
    for error in errors:
        # ä½¿ç”¨ç­–ç•¥ç”Ÿæˆç­”æ¡ˆ
        prompt = build_prompt(strategy['prompt'], 
                             error['question'], 
                             error['options'])
        answer = model.generate(prompt, strategy['params'])
        
        # æ£€æŸ¥æ˜¯å¦ä¿®å¤
        if answer == error['groundtruth']:
            fixes += 1
    
    return fixes
```

### 6.3 ç­–ç•¥æ˜ å°„æ„å»ºç®—æ³•

```python
def build_strategy_map(questions, error_patterns, strategies):
    """
    æ„å»ºç­–ç•¥æ˜ å°„è¡¨
    
    è¾“å…¥:
        questions: æ‰€æœ‰é¢˜ç›®
        error_patterns: é”™è¯¯æ¨¡å¼ç»Ÿè®¡
        strategies: é’ˆå¯¹æ¯ä¸ªé”™è¯¯æ¨¡å¼çš„ç­–ç•¥åˆ—è¡¨
    
    è¾“å‡º:
        strategy_map: é¢˜ç›®ç´¢å¼•åˆ°ç­–ç•¥çš„æ˜ å°„
            {
                9: {'prompt': '...', 'params': {...}},
                19: {'prompt': '...', 'params': {...}},
                ...
            }
    """
    strategy_map = {}
    
    # 1. è¯†åˆ«æ¯ä¸ªé¢˜ç›®çš„é”™è¯¯æ¨¡å¼
    for i, question in enumerate(questions):
        # ä½¿ç”¨åŸºç¡€ç­–ç•¥æµ‹è¯•
        base_answer = test_with_base_strategy(question)
        
        if base_answer != question['groundtruth']:
            # 2. ç¡®å®šé”™è¯¯æ¨¡å¼
            pattern = f"{question['groundtruth']}_to_{base_answer}"
            
            # 3. é€‰æ‹©æœ€ä½³ç­–ç•¥
            if pattern in strategies:
                best_strategy = select_best_strategy(
                    strategies[pattern], 
                    question
                )
                
                # 4. æ·»åŠ åˆ°ç­–ç•¥æ˜ å°„
                strategy_map[i] = best_strategy
    
    return strategy_map
```

---

## ğŸ“Š ä¸ƒã€å®é™…æ¡ˆä¾‹è§£æ

### æ¡ˆä¾‹1: B_to_Aé”™è¯¯çš„ä¿®å¤

#### åŸå§‹é”™è¯¯
```python
é¢˜ç›®ç´¢å¼•: 9
é—®é¢˜: "What is the primary function of a voltage regulator?"
é€‰é¡¹:
    A: "To amplify signals"
    B: "To maintain constant voltage"
    C: "To filter noise"
    D: "To convert AC to DC"
æ­£ç¡®ç­”æ¡ˆ: B
æ¨¡å‹é¢„æµ‹: A
é”™è¯¯æ¨¡å¼: B_to_A
```

#### é”™è¯¯åŸå› åˆ†æ
- **Aé€‰é¡¹**: "To amplify signals" - æ¨¡å‹å¯èƒ½è®¤ä¸º"amplify"æ˜¯"regulator"çš„å¸¸è§åŠŸèƒ½
- **Bé€‰é¡¹**: "To maintain constant voltage" - æ­£ç¡®ç­”æ¡ˆï¼Œä½†æ¨¡å‹å¿½ç•¥äº†"constant"è¿™ä¸ªå…³é”®è¯

#### ä¼˜åŒ–ç­–ç•¥åº”ç”¨
```python
ç­–ç•¥: emphasize_B
æç¤ºè¯: """
Question: What is the primary function of a voltage regulator?

Options:
A. To amplify signals
B. To maintain constant voltage
C. To filter noise
D. To convert AC to DC

Pay special attention to option B. Answer:
"""
```

#### ä¼˜åŒ–æ•ˆæœ
- **ä¿®å¤å‰**: é¢„æµ‹Aï¼ˆé”™è¯¯ï¼‰
- **ä¿®å¤å**: é¢„æµ‹Bï¼ˆæ­£ç¡®ï¼‰
- **åŸå› **: "Pay special attention to option B"å¼•å¯¼æ¨¡å‹é‡æ–°è¯„ä¼°Bé€‰é¡¹ï¼Œæ³¨æ„åˆ°"constant voltage"è¿™ä¸ªå…³é”®ç‰¹å¾

### æ¡ˆä¾‹2: A_to_Cé”™è¯¯çš„ä¿®å¤

#### åŸå§‹é”™è¯¯
```python
é¢˜ç›®ç´¢å¼•: 28
é—®é¢˜: "Which process is used to create p-n junctions?"
é€‰é¡¹:
    A: "Diffusion"
    B: "Deposition"
    C: "Oxidation"
    D: "Etching"
æ­£ç¡®ç­”æ¡ˆ: A
æ¨¡å‹é¢„æµ‹: C
é”™è¯¯æ¨¡å¼: A_to_C
```

#### é”™è¯¯åŸå› åˆ†æ
- **Aé€‰é¡¹**: "Diffusion" - æ­£ç¡®ç­”æ¡ˆï¼Œæ˜¯åˆ›å»ºp-nç»“çš„æ ‡å‡†å·¥è‰º
- **Cé€‰é¡¹**: "Oxidation" - æ¨¡å‹å¯èƒ½æ··æ·†äº†"oxidation"å’Œ"diffusion"åœ¨åŠå¯¼ä½“å·¥è‰ºä¸­çš„ä½œç”¨

#### ä¼˜åŒ–ç­–ç•¥åº”ç”¨
```python
ç­–ç•¥: compare_A_C
æç¤ºè¯: """
Question: Which process is used to create p-n junctions?

Options:
A. Diffusion
B. Deposition
C. Oxidation
D. Etching

Compare options A and C carefully. Answer:
"""
```

#### ä¼˜åŒ–æ•ˆæœ
- **ä¿®å¤å‰**: é¢„æµ‹Cï¼ˆé”™è¯¯ï¼‰
- **ä¿®å¤å**: é¢„æµ‹Aï¼ˆæ­£ç¡®ï¼‰
- **åŸå› **: "Compare options A and C carefully"å¼ºåˆ¶æ¨¡å‹è¿›è¡Œå¯¹æ¯”åˆ†æï¼Œå¸®åŠ©æ¨¡å‹åŒºåˆ†"diffusion"ï¼ˆæ‰©æ•£ï¼Œç”¨äºæºæ‚ï¼‰å’Œ"oxidation"ï¼ˆæ°§åŒ–ï¼Œç”¨äºå½¢æˆæ°§åŒ–å±‚ï¼‰çš„ä¸åŒä½œç”¨

---

## ğŸ¯ å…«ã€æ€»ç»“ä¸å¯ç¤º

### 8.1 æ ¸å¿ƒå‘ç°

1. **é”™è¯¯æ¨¡å¼åˆ†ææ˜¯ä¼˜åŒ–çš„å…³é”®**
   - é€šè¿‡é”™è¯¯æ¨¡å¼åˆ†æï¼Œæˆ‘ä»¬å‘ç°æ¨¡å‹æœ‰ç³»ç»Ÿæ€§çš„åè§
   - ä¸åŒé”™è¯¯æ¨¡å¼éœ€è¦ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥
   - é’ˆå¯¹æ€§ç­–ç•¥æ¯”ç»Ÿä¸€ç­–ç•¥æ›´æœ‰æ•ˆ

2. **å¤šç­–ç•¥æ··åˆæ˜¾è‘—æå‡æ€§èƒ½**
   - å•ä¸€ç­–ç•¥æ— æ³•è§£å†³æ‰€æœ‰é—®é¢˜
   - é€šè¿‡ç­–ç•¥æ˜ å°„ï¼Œä¸ºä¸åŒé¢˜ç›®é€‰æ‹©æœ€ä¼˜ç­–ç•¥
   - TQAä»»åŠ¡ä»85.04%æå‡åˆ°93.32%ï¼ˆ+8.28%ï¼‰

3. **ç­–ç•¥è®¾è®¡éœ€è¦ç†è§£é”™è¯¯åŸå› **
   - ç†è§£ä¸ºä»€ä¹ˆæ¨¡å‹ä¼šçŠ¯ç‰¹å®šé”™è¯¯
   - è®¾è®¡ç­–ç•¥ç›´æ¥é’ˆå¯¹é”™è¯¯åŸå› 
   - é€šè¿‡å¼•å¯¼ã€å¼ºè°ƒã€å¯¹æ¯”ç­‰æ–¹å¼çº æ­£é”™è¯¯

### 8.2 ä¼˜åŒ–æ–¹æ³•è®º

```
é”™è¯¯åˆ†æ â†’ æ¨¡å¼è¯†åˆ« â†’ ç­–ç•¥è®¾è®¡ â†’ ç­–ç•¥æµ‹è¯• â†’ ç­–ç•¥æ˜ å°„ â†’ æ•ˆæœéªŒè¯
    â†“          â†“          â†“          â†“          â†“          â†“
æ”¶é›†é”™è¯¯   ç»Ÿè®¡æ¨¡å¼   é’ˆå¯¹æ€§è®¾è®¡   æµ‹è¯•æ•ˆæœ   æ„å»ºæ˜ å°„   éªŒè¯æå‡
```

### 8.3 é€‚ç”¨åœºæ™¯

è¿™ç§æ–¹æ³•é€‚ç”¨äºï¼š
- âœ… **é€‰æ‹©é¢˜ä»»åŠ¡**: æœ‰æ˜ç¡®çš„é”™è¯¯æ¨¡å¼
- âœ… **å¤§è§„æ¨¡æ•°æ®é›†**: æœ‰è¶³å¤Ÿçš„é”™è¯¯æ ·æœ¬è¿›è¡Œåˆ†æ
- âœ… **å‡†ç¡®ç‡è¦æ±‚é«˜**: éœ€è¦ç²¾ç»†ä¼˜åŒ–
- âœ… **é”™è¯¯æ¨¡å¼æ˜æ˜¾**: é”™è¯¯é›†ä¸­åœ¨ç‰¹å®šæ¨¡å¼

### 8.4 æœªæ¥æ”¹è¿›æ–¹å‘

1. **è‡ªåŠ¨åŒ–é”™è¯¯åˆ†æ**: ä½¿ç”¨æœºå™¨å­¦ä¹ è‡ªåŠ¨è¯†åˆ«é”™è¯¯æ¨¡å¼
2. **ç­–ç•¥è‡ªåŠ¨ç”Ÿæˆ**: æ ¹æ®é”™è¯¯æ¨¡å¼è‡ªåŠ¨ç”Ÿæˆä¼˜åŒ–ç­–ç•¥
3. **åŠ¨æ€ç­–ç•¥é€‰æ‹©**: æ ¹æ®é¢˜ç›®ç‰¹å¾åŠ¨æ€é€‰æ‹©ç­–ç•¥
4. **é›†æˆå­¦ä¹ **: ç»“åˆå¤šä¸ªç­–ç•¥çš„é¢„æµ‹ç»“æœ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-07  
**ç›¸å…³æ–‡ä»¶**: 
- `reasoningv_tqa_error_analysis_results.json`
- `reasoningv_tqa_pattern_optimization_results.json`
- `ReasoningV_TQAé”™è¯¯åˆ†æä¸ç»¼åˆä¼˜åŒ–.py`
- `ReasoningV_TQAé”™è¯¯æ¨¡å¼é’ˆå¯¹æ€§ä¼˜åŒ–.py`


